# 18. Ограничения и известные проблемы

KyroOS находится на стадии активной разработки (alpha-версия) и не предназначена для использования в производственных средах. В текущей реализации присутствует ряд ограничений и не полностью реализованных функциональных возможностей.

## 18.1. Архитектурные ограничения

### Управление памятью

-   **Примитивная аллокация блоков `fs_disk`:** Дисковая файловая система `fs_disk` использует очень упрощенный механизм выделения блоков (счетчик `next_free_block`), что приводит к невозможности повторного использования освобожденных блоков и быстрой фрагментации дискового пространства.
-   **Неэффективная запись `KyroFS`:** Операции записи в in-memory файловую систему KyroFS могут быть неэффективными, особенно при увеличении размера файлов, из-за частых операций `kmalloc`/`kfree` и `memcpy` для перераспределения буферов.

### Многозадачность и синхронизация

-   **Отсутствие полноценных примитивов синхронизации:** В ядре отсутствуют мьютексы, семафоры и спинлоки. Единственный механизм синхронизации — глобальное отключение/включение прерываний, что является грубым методом и неприемлемо для длительных блокировок.
-   **Отсутствие поддержки многоядерности (SMP):** Ядро спроектировано для однопроцессорных систем. Отсутствие спинлоков и других механизмов защиты общих данных делает его непригодным для работы на многоядерных процессорах без существенных доработок.
-   **Неполный механизм блокировки потоков:** Несмотря на наличие состояния `THREAD_BLOCKED`, полноценный механизм перевода потоков в ожидание и их пробуждения (например, по событию или освобождению ресурса) реализован лишь частично и требует доработки.

### Файловая система

-   **Низкая масштабируемость `fs_disk`:** `fs_disk` является плоской файловой системой (нет поддержки иерархических директорий) с жестким ограничением на количество файлов (32). Она не интегрирована в VFS.
-   **Отсутствие модели прав доступа:** Ни VFS, ни конкретные реализации ФС (`KyroFS`, `fs_disk`) не поддерживают полноценную модель прав доступа (пользователь, группа, другие; чтение, запись, выполнение).
-   **Отсутствие кэширования данных в `fs_disk`:** Дисковая ФС не кэширует блоки данных, что приводит к прямому обращению к диску при каждом чтении/записи и снижает производительность.

### Сеть

-   **Тесная связь ядра сети с драйвером:** Основные функции сетевого ядра (`net_init`, `net_register_device`) реализованы внутри драйвера E1000, что делает подсистему менее модульной и затрудняет добавление других сетевых драйверов.
-   **Частичная реализация TCP:** Протокол TCP реализован не полностью, хотя и содержит конечный автомат состояний. Возможны проблемы с надежностью, производительностью и соответствием спецификациям.

### Графическая подсистема

-   **Отсутствие ускорения GPU:** Все графические операции выполняются программно центральным процессором, что ограничивает производительность.
-   **Прямой доступ к Framebuffer для Userspace:** Пользовательские приложения получают прямой, неограниченный доступ к памяти framebuffer, что упрощает разработку, но не предоставляет защиты и требует, чтобы вся логика оконной системы (композиция, управление окнами) реализовывалась в пользовательском пространстве.
-   **Внутренний GUI:** Существующий GUI-тулкит ядра (`gui.c`) предназначен исключительно для внутреннего использования и не предоставляет API для приложений пользовательского пространства.

### Межпроцессное взаимодействие (IPC)

-   **Отсутствие каналов (Pipes):** Классический механизм IPC "каналы" не реализован.
-   **Отсутствие явного API разделяемой памяти:** Хотя потоки одного процесса разделяют память, явного API для создания и управления сегментами разделяемой памяти для разных процессов не предусмотрено.

## 18.2. Нереализованные подсистемы

-   **USB-стек:** Поддержка устройств USB отсутствует.
-   **AHCI-драйвер:** Поддержка современных SATA-контроллеров отсутствует, используется только устаревший IDE-драйвер.
-   **Полноценная `libc`:** Отсутствует полноценная стандартная библиотека C для пользовательского пространства, что вынуждает приложения либо использовать минимальные обертки syscall, либо включать свою реализацию.
-   **Виртуализация:** На данный момент никаких механизмов аппаратной или программной виртуализации не предусмотрено.

## 18.3. Компромиссы проектирования

-   **Простота и читаемость:** Многие решения в KyroOS приняты в угоду простоте реализации и легкости понимания кода, что иногда идет в ущерб производительности, безопасности или функциональности.
-   **Минимализм:** Целью было создание работающей системы с нуля, а не полноценной коммерческой ОС. Это привело к сознательному отказу от многих сложных функций на начальных этапах.
-   **Образовательная направленность:** Система служит учебным проектом, что объясняет некоторые упрощения и "TODO" в коде.

## 18.4. Известные проблемы

-   **Альфа-качество:** Система находится в альфа-стадии разработки, что означает высокую вероятность наличия багов, нестабильность и возможные непредвиденные сбои.
-   **Несоответствие POSIX:** API KyroOS не полностью соответствует стандарту POSIX, что затрудняет портирование существующего программного обеспечения.
-   **Низкая производительность:** Из-за отсутствия оптимизаций, развитых алгоритмов и кэширования в некоторых подсистемах производительность может быть низкой.
