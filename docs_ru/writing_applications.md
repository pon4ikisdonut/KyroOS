# Написание приложений для KyroOS

Разработка приложений специально для KyroOS требует понимания ее нативной среды и доступных API. Это руководство описывает, как структурировать, писать и собирать ваши приложения для запуска на KyroOS.

## Структура приложения

Типичное приложение пользовательского пространства KyroOS будет иметь следующую базовую структуру:

```
my_app/
├── main.c
├── Makefile
└── ... (другие исходные файлы)
```

## API KyroOS

Приложения взаимодействуют с ядром KyroOS в основном через:

*   **Системные вызовы:** Это основной интерфейс для запроса служб у ядра (например, ввод-вывод файлов, управление процессами, выделение памяти). См. `src/include/syscall.h` для полного списка доступных системных вызовов и их аргументов. Вы обычно будете использовать функцию-обертку, которая вызывает инструкцию `int 0x80` (или эквивалентную).
*   **Библиотека пользовательского пространства (`userspace/lib/`):** KyroOS предоставляет пользовательскую стандартную библиотеку C в `userspace/lib/`. Эта библиотека предлагает общие функции, такие как манипуляции со строками (`kstrcpy`, `kstrlen`), выделение памяти (`kmalloc`, `kfree`) и базовый ввод-вывод. Ознакомьтесь с доступными здесь функциями, прежде чем реализовывать свои собственные.

## Пример "Hello, World!"

Давайте создадим простое приложение "Hello, World!":

**`main.c`:**
```c
#include <userspace.h> // Общие включения пользовательского пространства
#include <syscall.h>   // Для системных вызовов KyroOS
#include <kstring.h>   // Для kprintf и других строковых функций

int main(int argc, char *argv[]) {
    kprintf("Hello, KyroOS World!\n");
    return 0;
}
```

**`Makefile`:**
```makefile
CC = x86_64-elf-gcc
LD = x86_64-elf-ld

TARGET = hello
SOURCES = main.c
OBJS = $(SOURCES:.c=.o)
LDFLAGS = -T ../../linker.ld -lc -lkuserspace

INCLUDES = -I../../src/include -I../../userspace/lib

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CC) $(OBJS) $(LDFLAGS) -o $@

.c.o:
	$(CC) -c $< -o $@ $(INCLUDES) -ffreestanding -O2 -Wall -Wextra

clean:
	rm -f $(OBJS) $(TARGET)
```

**Примечание:** `LDFLAGS` может потребовать корректировки в зависимости от точного пути к `linker.ld` и `userspace/lib` в вашей структуре проекта. Флаг `-lkuserspace` предполагает, что ваша библиотека пользовательского пространства скомпилирована и доступна для компоновки.

## Сборка вашего приложения

1.  **Набор инструментов:** Убедитесь, что у вас установлен кросс-компилятор `x86_64-elf-gcc` и связанные с ним инструменты.
    ```bash
    sudo apt-get install build-essential nasm xorriso gcc-x86-64-linux-gnu
    ```
2.  **Перейдите:** Перейдите в каталог вашего приложения (например, `my_app/`).
3.  **Сборка:** Запустите `make`. Это скомпилирует `main.c` и скомпонует его с библиотекой пользовательского пространства KyroOS и обертками системных вызовов, создав исполняемый файл (например, `hello`).

## Интеграция в KyroOS

Чтобы запустить ваше приложение на KyroOS, вы обычно помещаете скомпилированный исполняемый файл в каталог `userspace/` в дереве исходного кода KyroOS. Процесс сборки KyroOS затем включит его в окончательный ISO.

Более подробные примеры и понимание того, как создаются системные утилиты, можно найти в существующих приложениях в [каталоге `userspace/` репозитория KyroOS](https://github.com/pon4ikisdonut/KyroOS/tree/main/userspace). 
Основные системные компоненты, такие как `init` и `shell`, являются отличными ресурсами для изучения того, как взаимодействовать с ядром KyroOS и его библиотеками.
